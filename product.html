<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product | JMPOTTERS</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <style>
        /* === PROFESSIONAL E-COMMERCE STYLES === */
        :root {
            /* Professional Color Palette */
            --primary: #111827;
            --secondary: #374151;
            --accent: #D97706;
            --accent-hover: #B45309;
            --light: #F9FAFB;
            --lighter: #F3F4F6;
            --border: #E5E7EB;
            --text: #1F2937;
            --text-light: #6B7280;
            --success: #059669;
            --error: #DC2626;
            --warning: #D97706;
            
            /* Typography */
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-heading: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            
            /* Spacing */
            --space-xs: 0.5rem;
            --space-sm: 0.75rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            /* Border Radius */
            --radius-sm: 0.25rem;
            --radius: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            
            /* Transitions */
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--light);
            color: var(--text);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Header */
        .site-header {
            background: white;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
        }

        .header-container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1rem var(--space-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .logo-icon {
            color: var(--accent);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .header-action {
            position: relative;
            background: none;
            border: none;
            color: var(--secondary);
            padding: var(--space-sm);
            cursor: pointer;
            border-radius: var(--radius);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .header-action:hover {
            background: var(--lighter);
            color: var(--primary);
        }

        .header-action i {
            font-size: 1.25rem;
        }

        .badge {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--error);
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translate(25%, -25%);
        }

        /* Main Container */
        .product-container {
            max-width: 1280px;
            margin: 0 auto;
            padding: var(--space-2xl) var(--space-lg);
        }

        /* Breadcrumb */
        .breadcrumb {
            margin-bottom: var(--space-xl);
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .breadcrumb a {
            color: var(--secondary);
            text-decoration: none;
            transition: var(--transition);
        }

        .breadcrumb a:hover {
            color: var(--accent);
        }

        .breadcrumb span {
            color: var(--text-light);
            margin: 0 var(--space-xs);
        }

        /* Product Grid */
        .product-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-2xl);
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        @media (max-width: 1024px) {
            .product-grid {
                grid-template-columns: 1fr;
                gap: var(--space-xl);
            }
        }

        /* Image Gallery */
        .image-gallery {
            padding: var(--space-xl);
            position: relative;
        }

        .main-image-wrapper {
            position: relative;
            overflow: hidden;
            border-radius: var(--radius-lg);
            background: var(--lighter);
            cursor: zoom-in;
            aspect-ratio: 1;
        }

        .main-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: transform 0.3s ease;
            transform-origin: center center;
        }

        .main-image.zoomed {
            cursor: zoom-out;
        }

        .image-zoom-hint {
            position: absolute;
            bottom: var(--space-md);
            right: var(--space-md);
            background: rgba(0, 0, 0, 0.75);
            color: white;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius);
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            backdrop-filter: blur(4px);
            pointer-events: none;
        }

        /* Product Details */
        .product-details {
            padding: var(--space-xl);
        }

        .product-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1.2;
            margin-bottom: var(--space-sm);
        }

        .product-meta {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-lg);
            border-bottom: 1px solid var(--border);
        }

        .sku {
            color: var(--text-light);
            font-size: 0.875rem;
        }

        .rating {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            color: var(--warning);
        }

        .reviews {
            color: var(--text-light);
            font-size: 0.875rem;
        }

        /* Price */
        .price-section {
            margin-bottom: var(--space-xl);
        }

        .current-price {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .original-price {
            font-size: 1.25rem;
            color: var(--text-light);
            text-decoration: line-through;
        }

        .discount-badge {
            background: var(--error);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 600;
        }

        /* Stock */
        .stock-info {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }

        .stock-badge {
            padding: 0.375rem 0.75rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .stock-in {
            background: rgba(5, 150, 105, 0.1);
            color: var(--success);
            border: 1px solid rgba(5, 150, 105, 0.2);
        }

        .stock-count {
            color: var(--text-light);
            font-size: 0.875rem;
        }

        /* Variant Selectors - WOOCOMMERCE STYLE */
        .variant-section {
            margin-bottom: var(--space-lg);
        }

        .variant-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: var(--space-sm);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Color Selector - DROPDOWN STYLE */
        .color-selector {
            position: relative;
            margin-bottom: var(--space-md);
        }

        .color-selected {
            width: 100%;
            padding: 0.75rem;
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: var(--transition);
        }

        .color-selected:hover {
            border-color: var(--accent);
        }

        .color-preview {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .color-swatch {
            width: 24px;
            height: 24px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
        }

        .color-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-top: 0.25rem;
            box-shadow: var(--shadow-lg);
            z-index: 100;
            display: none;
        }

        .color-dropdown.active {
            display: block;
        }

        .color-option {
            padding: 0.75rem;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid var(--border);
        }

        .color-option:last-child {
            border-bottom: none;
        }

        .color-option:hover {
            background: var(--lighter);
        }

        .color-option.selected {
            background: rgba(217, 119, 6, 0.1);
            color: var(--accent);
        }

        /* Size Selector - LIST STYLE */
        .size-selector {
            position: relative;
        }

        .size-selected {
            width: 100%;
            padding: 0.75rem;
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: var(--transition);
        }

        .size-selected:hover {
            border-color: var(--accent);
        }

        .size-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-top: 0.25rem;
            box-shadow: var(--shadow-lg);
            z-index: 100;
            display: none;
        }

        .size-dropdown.active {
            display: block;
        }

        .size-option {
            padding: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .size-option:last-child {
            border-bottom: none;
        }

        .size-option:hover {
            background: var(--lighter);
        }

        .size-option.selected {
            background: rgba(217, 119, 6, 0.1);
            color: var(--accent);
        }

        .size-stock {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        .size-option.out-of-stock {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .size-option.low-stock .size-stock {
            color: var(--warning);
            font-weight: 600;
        }

        /* Quantity */
        .quantity-section {
            margin-bottom: var(--space-lg);
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            max-width: 160px;
        }

        .qty-btn {
            width: 40px;
            height: 40px;
            background: white;
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .qty-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .qty-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .qty-input {
            flex: 1;
            height: 40px;
            text-align: center;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            color: var(--text);
            background: white;
        }

        .qty-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.1);
        }

        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }

        .btn {
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            border: none;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: white;
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--accent);
            color: var(--accent);
            transform: translateY(-1px);
        }

        .btn-secondary.active {
            background: var(--error);
            border-color: var(--error);
            color: white;
        }

        .btn-whatsapp {
            width: 100%;
            background: #25D366;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            font-weight: 600;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            transition: var(--transition);
            margin-bottom: var(--space-xl);
        }

        .btn-whatsapp:hover {
            background: #128C7E;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Description */
        .description-section {
            margin-bottom: var(--space-xl);
        }

        .description-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: var(--space-md);
            color: var(--primary);
        }

        .description-content {
            color: var(--text);
            line-height: 1.6;
        }

        /* Cart Panel */
        .cart-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: var(--shadow-xl);
            z-index: 2000;
            transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }

        @media (max-width: 640px) {
            .cart-panel {
                width: 100%;
                right: -100%;
            }
        }

        .cart-panel.active {
            right: 0;
        }

        .cart-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
        }

        .cart-close {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            padding: var(--space-sm);
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .cart-close:hover {
            background: var(--lighter);
            color: var(--text);
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-lg);
        }

        .cart-empty {
            text-align: center;
            padding: var(--space-2xl) var(--space-lg);
            color: var(--text-light);
        }

        .cart-footer {
            padding: var(--space-lg);
            border-top: 1px solid var(--border);
            background: var(--lighter);
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
        }

        .cart-checkout {
            width: 100%;
            padding: 1rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
        }

        .cart-checkout:hover {
            background: var(--accent-hover);
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1500;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Loading State */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: var(--space-lg);
        }

        /* Error State */
        .error {
            text-align: center;
            padding: var(--space-2xl);
            max-width: 500px;
            margin: 0 auto;
        }

        .error-icon {
            font-size: 3rem;
            color: var(--error);
            margin-bottom: var(--space-lg);
        }

        .error-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: var(--space-sm);
            color: var(--primary);
        }

        .error-message {
            color: var(--text-light);
            margin-bottom: var(--space-lg);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <i class="fas fa-gem logo-icon"></i>
                JMPOTTERS
            </a>
            
            <div class="header-actions">
                <button class="header-action" id="wishlistBtn" title="Wishlist">
                    <i class="far fa-heart"></i>
                    <span class="badge" id="wishlistCount">0</span>
                </button>
                
                <button class="header-action" id="cartBtn" title="Cart">
                    <i class="fas fa-shopping-bag"></i>
                    <span class="badge" id="cartCount">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Breadcrumb -->
    <div class="product-container">
        <nav class="breadcrumb">
            <a href="index.html">Home</a>
            <span>/</span>
            <a href="mensfootwear.html">Men's Footwear</a>
            <span>/</span>
            <span id="productName">Loading...</span>
        </nav>

        <!-- Product Content -->
        <div id="productContent">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading product details...</p>
            </div>
        </div>
    </div>

    <!-- Cart Panel -->
    <div class="cart-panel" id="cartPanel">
        <div class="cart-header">
            <h3 class="cart-title">Shopping Cart</h3>
            <button class="cart-close" id="closeCartBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="cart-items" id="cartItems">
            <div class="cart-empty">
                <i class="fas fa-shopping-bag" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                <p>Your cart is empty</p>
            </div>
        </div>
        
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cartTotal">â‚¦0</span>
            </div>
            <a href="#" class="cart-checkout" id="whatsappCheckout" target="_blank">
                <i class="fab fa-whatsapp"></i>
                Checkout on WhatsApp
            </a>
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        
        // Product data (will be loaded from Supabase)
        let currentProduct = null;
        let productColors = [];
        let productSizes = [];
        let colorSizeMap = {};
        let selectedColor = null;
        let selectedSize = null;
        let quantity = 1;

        // Cart data
        let cart = JSON.parse(localStorage.getItem('jmpotters_cart')) || [];
        let wishlist = JSON.parse(localStorage.getItem('jmpotters_wishlist')) || [];

        // Supabase Configuration
        const SUPABASE_URL = 'https://tmpggeeuwdvlngvfncaa.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRtcGdnZWV1d2R2bG5ndmZuY2FhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxOTc0MDYsImV4cCI6MjA3Nzc3MzQwNn0.EKzkKWmzYMvQuN11vEjRTDHrUbh6dYXk7clxVsYQ0b4';

        // Initialize when DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ JMPOTTERS Professional Product Page Initialized');
            
            // Initialize UI
            initUI();
            
            // Load product from URL
            loadProductFromURL();
        });

        function initUI() {
            // Setup cart panel
            const cartBtn = document.getElementById('cartBtn');
            const closeCartBtn = document.getElementById('closeCartBtn');
            const cartPanel = document.getElementById('cartPanel');
            const overlay = document.getElementById('overlay');
            
            cartBtn.addEventListener('click', () => {
                cartPanel.classList.add('active');
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden';
                updateCartPanel();
            });
            
            closeCartBtn.addEventListener('click', () => {
                cartPanel.classList.remove('active');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            });
            
            overlay.addEventListener('click', () => {
                cartPanel.classList.remove('active');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            });
            
            // Update cart/wishlist counts
            updateHeaderCounts();
        }

        function updateHeaderCounts() {
            const cartCount = document.getElementById('cartCount');
            const wishlistCount = document.getElementById('wishlistCount');
            
            if (cartCount) {
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCount.textContent = totalItems;
                cartCount.style.display = totalItems > 0 ? 'block' : 'none';
            }
            
            if (wishlistCount) {
                wishlistCount.textContent = wishlist.length;
                wishlistCount.style.display = wishlist.length > 0 ? 'block' : 'none';
            }
        }

        async function loadProductFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const slug = urlParams.get('slug');
            
            if (!slug) {
                showError('No product specified');
                return;
            }
            
            try {
                // Load product from Supabase
                await loadProductData(slug);
                
                // Render product
                renderProduct();
                
            } catch (error) {
                console.error('Error loading product:', error);
                showError('Failed to load product');
            }
        }

        async function loadProductData(slug) {
            // Create Supabase client
            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            
            // Fetch product
            const { data: product, error: productError } = await supabase
                .from('products')
                .select('*')
                .eq('slug', slug)
                .eq('is_active', true)
                .single();
            
            if (productError || !product) {
                throw new Error('Product not found');
            }
            
            currentProduct = product;
            
            // Fetch colors
            const { data: colors } = await supabase
                .from('product_colors')
                .select('*')
                .eq('product_id', product.id)
                .order('sort_order');
            
            productColors = colors || [];
            
            // Fetch sizes
            const { data: sizes } = await supabase
                .from('product_sizes')
                .select('*')
                .eq('product_id', product.id)
                .order('size_value');
            
            productSizes = sizes || [];
            
            // Build color-size mapping
            buildColorSizeMapping();
        }

        function buildColorSizeMapping() {
            colorSizeMap = {};
            
            productColors.forEach(color => {
                colorSizeMap[color.id] = productSizes.filter(size => size.color_id === color.id);
            });
        }

        function renderProduct() {
            const productContent = document.getElementById('productContent');
            if (!productContent || !currentProduct) return;
            
            // Format price
            const formattedPrice = formatPrice(currentProduct.price);
            const fakePrice = Math.round(currentProduct.price * 1.35);
            const isFootwear = ['mensfootwear', 'womensfootwear'].includes(
                currentProduct.category_id?.toString() || 'mensfootwear'
            );
            
            productContent.innerHTML = `
                <div class="product-grid">
                    <!-- Image Section -->
                    <div class="image-gallery">
                        <div class="main-image-wrapper" id="mainImageWrapper">
                            <img src="https://ebuzome.github.io/JMPOTTERS/assets/images/mensfootwear/${currentProduct.image_url}" 
                                 alt="${currentProduct.name}" 
                                 class="main-image" 
                                 id="mainImage"
                                 onerror="this.src='https://ebuzome.github.io/JMPOTTERS/assets/images/placeholder.jpg'">
                            <div class="image-zoom-hint">
                                <i class="fas fa-search-plus"></i>
                                Click to zoom
                            </div>
                        </div>
                    </div>
                    
                    <!-- Details Section -->
                    <div class="product-details">
                        <h1 class="product-title">${currentProduct.name}</h1>
                        
                        <div class="product-meta">
                            <span class="sku">SKU: ${currentProduct.id}</span>
                            <div class="rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                            </div>
                            <span class="reviews">(24 reviews)</span>
                        </div>
                        
                        <div class="price-section">
                            <div class="current-price">
                                ${formattedPrice}
                                <span class="original-price">${formatPrice(fakePrice)}</span>
                                <span class="discount-badge">35% OFF</span>
                            </div>
                        </div>
                        
                        <div class="stock-info">
                            <span class="stock-badge stock-in">
                                <i class="fas fa-check-circle"></i>
                                In Stock
                            </span>
                            <span class="stock-count">${currentProduct.stock || 100} units available</span>
                        </div>
                        
                        ${isFootwear && productColors.length > 0 ? `
                        <!-- Color Selector -->
                        <div class="variant-section">
                            <label class="variant-label">Color</label>
                            <div class="color-selector">
                                <div class="color-selected" id="colorSelected">
                                    <div class="color-preview">
                                        <div class="color-swatch" style="background-color: ${productColors[0]?.color_code || '#666'}"></div>
                                        <span id="selectedColorName">Select Color</span>
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="color-dropdown" id="colorDropdown">
                                    ${productColors.map(color => `
                                        <div class="color-option" data-color-id="${color.id}" data-color-name="${color.color_name}">
                                            <div class="color-swatch" style="background-color: ${color.color_code || '#666'}"></div>
                                            <span>${color.color_name}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Size Selector -->
                        <div class="variant-section">
                            <label class="variant-label">Size</label>
                            <div class="size-selector">
                                <div class="size-selected" id="sizeSelected">
                                    <span id="selectedSizeValue">Select Size</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="size-dropdown" id="sizeDropdown">
                                    <div class="size-option no-selection">
                                        Please select a color first
                                    </div>
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- Quantity -->
                        <div class="variant-section">
                            <label class="variant-label">Quantity</label>
                            <div class="quantity-controls">
                                <button class="qty-btn" id="decreaseQty" ${quantity <= 1 ? 'disabled' : ''}>-</button>
                                <input type="number" class="qty-input" id="quantityInput" value="${quantity}" min="1" max="${currentProduct.stock || 100}">
                                <button class="qty-btn" id="increaseQty">+</button>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="addToCartBtn">
                                <i class="fas fa-shopping-cart"></i>
                                Add to Cart
                            </button>
                            <button class="btn btn-secondary" id="wishlistBtnPage">
                                <i class="far fa-heart"></i>
                                Add to Wishlist
                            </button>
                        </div>
                        
                        <!-- WhatsApp Button -->
                        <a href="https://wa.me/2348139583320" class="btn-whatsapp" target="_blank">
                            <i class="fab fa-whatsapp"></i>
                            Buy Now on WhatsApp
                        </a>
                        
                        <!-- Description -->
                        <div class="description-section">
                            <h3 class="description-title">Description</h3>
                            <div class="description-content">
                                ${currentProduct.description || 'Premium quality product from JMPOTTERS. Made with attention to detail and superior craftsmanship.'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Setup interactions
            setupProductInteractions();
            setupImageZoom();
        }

        function setupProductInteractions() {
            // Color selection
            const colorSelected = document.getElementById('colorSelected');
            const colorDropdown = document.getElementById('colorDropdown');
            const colorOptions = document.querySelectorAll('.color-option');
            
            if (colorSelected && colorDropdown) {
                colorSelected.addEventListener('click', () => {
                    colorDropdown.classList.toggle('active');
                    // Close other dropdowns
                    document.getElementById('sizeDropdown')?.classList.remove('active');
                });
                
                // Color options
                colorOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        const colorId = parseInt(option.dataset.colorId);
                        const colorName = option.dataset.colorName;
                        const colorCode = option.querySelector('.color-swatch').style.backgroundColor;
                        
                        // Update selection
                        selectedColor = { id: colorId, name: colorName };
                        
                        // Update UI
                        document.getElementById('selectedColorName').textContent = colorName;
                        document.querySelector('#colorSelected .color-swatch').style.backgroundColor = colorCode;
                        
                        // Mark selected
                        colorOptions.forEach(opt => opt.classList.remove('selected'));
                        option.classList.add('selected');
                        
                        // Close dropdown
                        colorDropdown.classList.remove('active');
                        
                        // Update size options
                        updateSizeOptions(colorId);
                    });
                });
            }
            
            // Size selection
            const sizeSelected = document.getElementById('sizeSelected');
            const sizeDropdown = document.getElementById('sizeDropdown');
            
            if (sizeSelected && sizeDropdown) {
                sizeSelected.addEventListener('click', () => {
                    if (!selectedColor) {
                        alert('Please select a color first');
                        return;
                    }
                    sizeDropdown.classList.toggle('active');
                    // Close other dropdowns
                    document.getElementById('colorDropdown')?.classList.remove('active');
                });
            }
            
            // Quantity controls
            const decreaseBtn = document.getElementById('decreaseQty');
            const increaseBtn = document.getElementById('increaseQty');
            const quantityInput = document.getElementById('quantityInput');
            
            if (decreaseBtn && increaseBtn && quantityInput) {
                decreaseBtn.addEventListener('click', () => {
                    const current = parseInt(quantityInput.value) || 1;
                    if (current > 1) {
                        quantityInput.value = current - 1;
                        quantity = quantityInput.value;
                        decreaseBtn.disabled = quantity <= 1;
                    }
                });
                
                increaseBtn.addEventListener('click', () => {
                    const current = parseInt(quantityInput.value) || 1;
                    const maxStock = selectedSize?.stock || currentProduct.stock || 100;
                    if (current < maxStock) {
                        quantityInput.value = current + 1;
                        quantity = quantityInput.value;
                    }
                });
                
                quantityInput.addEventListener('change', () => {
                    const value = parseInt(quantityInput.value) || 1;
                    const maxStock = selectedSize?.stock || currentProduct.stock || 100;
                    quantityInput.value = Math.max(1, Math.min(value, maxStock));
                    quantity = quantityInput.value;
                    decreaseBtn.disabled = quantity <= 1;
                });
            }
            
            // Add to cart
            const addToCartBtn = document.getElementById('addToCartBtn');
            if (addToCartBtn) {
                addToCartBtn.addEventListener('click', addToCart);
            }
            
            // Wishlist
            const wishlistBtn = document.getElementById('wishlistBtnPage');
            if (wishlistBtn) {
                wishlistBtn.addEventListener('click', toggleWishlist);
            }
        }

        function updateSizeOptions(colorId) {
            const sizeDropdown = document.getElementById('sizeDropdown');
            if (!sizeDropdown) return;
            
            const availableSizes = colorSizeMap[colorId] || [];
            
            if (availableSizes.length === 0) {
                sizeDropdown.innerHTML = `
                    <div class="size-option no-selection">
                        No sizes available for this color
                    </div>
                `;
                return;
            }
            
            sizeDropdown.innerHTML = availableSizes.map(size => {
                const stock = size.stock_quantity || 0;
                let stockClass = '';
                let stockText = `${stock} in stock`;
                
                if (stock === 0) {
                    stockClass = 'out-of-stock';
                    stockText = 'Out of stock';
                } else if (stock < 5) {
                    stockClass = 'low-stock';
                    stockText = `${stock} left`;
                }
                
                return `
                    <div class="size-option ${stockClass}" data-size-id="${size.id}" data-size-value="${size.size_value}" data-stock="${stock}">
                        <span>${size.size_value}</span>
                        <span class="size-stock">${stockText}</span>
                    </div>
                `;
            }).join('');
            
            // Add event listeners to size options
            const sizeOptions = sizeDropdown.querySelectorAll('.size-option:not(.out-of-stock)');
            sizeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const sizeId = parseInt(option.dataset.sizeId);
                    const sizeValue = option.dataset.sizeValue;
                    const stock = parseInt(option.dataset.stock);
                    
                    // Update selection
                    selectedSize = {
                        id: sizeId,
                        value: sizeValue,
                        stock: stock
                    };
                    
                    // Update UI
                    document.getElementById('selectedSizeValue').textContent = sizeValue;
                    
                    // Mark selected
                    sizeOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    
                    // Close dropdown
                    sizeDropdown.classList.remove('active');
                    
                    // Update quantity max
                    const quantityInput = document.getElementById('quantityInput');
                    if (quantityInput) {
                        quantityInput.max = stock;
                        if (quantity > stock) {
                            quantity = stock;
                            quantityInput.value = stock;
                        }
                    }
                });
            });
        }

        function setupImageZoom() {
            const imageWrapper = document.getElementById('mainImageWrapper');
            const image = document.getElementById('mainImage');
            
            if (!imageWrapper || !image) return;
            
            let isZoomed = false;
            let scale = 1;
            
            imageWrapper.addEventListener('click', (e) => {
                if (!isZoomed) {
                    // Zoom in
                    scale = 2;
                    image.style.transform = `scale(${scale})`;
                    image.classList.add('zoomed');
                    isZoomed = true;
                } else {
                    // Zoom out
                    scale = 1;
                    image.style.transform = `scale(${scale})`;
                    image.classList.remove('zoomed');
                    isZoomed = false;
                }
            });
            
            // Hover zoom effect
            imageWrapper.addEventListener('mousemove', (e) => {
                if (!isZoomed) return;
                
                const rect = imageWrapper.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((e.clientY - rect.top) / rect.height) * 100;
                
                image.style.transformOrigin = `${x}% ${y}%`;
            });
        }

        function addToCart() {
            if (!currentProduct) return;
            
            const cartItem = {
                product_id: currentProduct.id,
                name: currentProduct.name,
                price: currentProduct.price,
                image_url: currentProduct.image_url,
                quantity: quantity,
                color_id: selectedColor?.id,
                color_name: selectedColor?.name,
                size_id: selectedSize?.id,
                size_value: selectedSize?.value,
                added_at: new Date().toISOString()
            };
            
            // Check if item already in cart
            const existingIndex = cart.findIndex(item => 
                item.product_id === cartItem.product_id && 
                item.color_id === cartItem.color_id && 
                item.size_id === cartItem.size_id
            );
            
            if (existingIndex !== -1) {
                cart[existingIndex].quantity += quantity;
            } else {
                cart.push(cartItem);
            }
            
            // Save to localStorage
            localStorage.setItem('jmpotters_cart', JSON.stringify(cart));
            
            // Update UI
            updateHeaderCounts();
            
            // Show success message
            showNotification(`${currentProduct.name} added to cart!`, 'success');
        }

        function toggleWishlist() {
            if (!currentProduct) return;
            
            const existingIndex = wishlist.findIndex(item => item.id === currentProduct.id);
            
            if (existingIndex !== -1) {
                // Remove from wishlist
                wishlist.splice(existingIndex, 1);
                showNotification(`${currentProduct.name} removed from wishlist`, 'info');
            } else {
                // Add to wishlist
                wishlist.push({
                    id: currentProduct.id,
                    name: currentProduct.name,
                    price: currentProduct.price,
                    image_url: currentProduct.image_url,
                    slug: currentProduct.slug
                });
                showNotification(`${currentProduct.name} added to wishlist!`, 'success');
            }
            
            // Save to localStorage
            localStorage.setItem('jmpotters_wishlist', JSON.stringify(wishlist));
            
            // Update UI
            updateHeaderCounts();
            
            // Update button state
            const wishlistBtn = document.getElementById('wishlistBtnPage');
            if (wishlistBtn) {
                const isInWishlist = wishlist.some(item => item.id === currentProduct.id);
                wishlistBtn.innerHTML = isInWishlist ? 
                    '<i class="fas fa-heart"></i> In Wishlist' :
                    '<i class="far fa-heart"></i> Add to Wishlist';
                wishlistBtn.classList.toggle('active', isInWishlist);
            }
        }

        function updateCartPanel() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            const whatsappCheckout = document.getElementById('whatsappCheckout');
            
            if (!cartItems || !cartTotal) return;
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="cart-empty">
                        <i class="fas fa-shopping-bag" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                        <p>Your cart is empty</p>
                    </div>
                `;
                cartTotal.textContent = 'â‚¦0';
                if (whatsappCheckout) whatsappCheckout.href = '#';
                return;
            }
            
            // Calculate total
            let total = 0;
            let itemsHTML = '';
            
            cart.forEach((item, index) => {
                const itemTotal = (item.price || 0) * item.quantity;
                total += itemTotal;
                
                itemsHTML += `
                    <div class="cart-item" style="display: flex; align-items: center; gap: 1rem; padding: 1rem 0; border-bottom: 1px solid var(--border);">
                        <img src="https://ebuzome.github.io/JMPOTTERS/assets/images/mensfootwear/${item.image_url}" 
                             alt="${item.name}" 
                             style="width: 60px; height: 60px; object-fit: cover; border-radius: var(--radius);"
                             onerror="this.src='https://ebuzome.github.io/JMPOTTERS/assets/images/placeholder.jpg'">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">${item.name}</div>
                            <div style="font-size: 0.875rem; color: var(--text-light);">
                                ${item.color_name ? `${item.color_name} â€¢ ` : ''}
                                ${item.size_value ? `Size ${item.size_value} â€¢ ` : ''}
                                ${formatPrice(item.price)}
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem;">
                                <button onclick="updateCartItem(${index}, -1)" style="background: var(--lighter); border: none; width: 24px; height: 24px; border-radius: var(--radius-sm); cursor: pointer;">-</button>
                                <span style="font-weight: 600;">${item.quantity}</span>
                                <button onclick="updateCartItem(${index}, 1)" style="background: var(--lighter); border: none; width: 24px; height: 24px; border-radius: var(--radius-sm); cursor: pointer;">+</button>
                                <button onclick="removeCartItem(${index})" style="margin-left: auto; background: none; border: none; color: var(--error); cursor: pointer;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            cartItems.innerHTML = itemsHTML;
            cartTotal.textContent = formatPrice(total);
            
            // Update WhatsApp checkout link
            if (whatsappCheckout) {
                let text = "I would like to purchase:\n";
                cart.forEach(item => {
                    let itemDescription = item.name;
                    if (item.color_name) itemDescription += ` (${item.color_name})`;
                    if (item.size_value) itemDescription += ` - Size ${item.size_value}`;
                    
                    const itemTotal = (item.price || 0) * item.quantity;
                    text += `- ${itemDescription} (${item.quantity} Ã— ${formatPrice(item.price)}) = ${formatPrice(itemTotal)}\n`;
                });
                text += `\n*Total: ${formatPrice(total)}*\n\nPlease confirm order & shipping details.`;
                whatsappCheckout.href = `https://wa.me/2348139583320?text=${encodeURIComponent(text)}`;
            }
        }

        // Cart functions for inline event handlers
        window.updateCartItem = function(index, change) {
            cart[index].quantity += change;
            if (cart[index].quantity <= 0) {
                cart.splice(index, 1);
            }
            localStorage.setItem('jmpotters_cart', JSON.stringify(cart));
            updateCartPanel();
            updateHeaderCounts();
        };
        
        window.removeCartItem = function(index) {
            cart.splice(index, 1);
            localStorage.setItem('jmpotters_cart', JSON.stringify(cart));
            updateCartPanel();
            updateHeaderCounts();
        };

        function showNotification(message, type = 'success') {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'var(--success)' : 'var(--error)'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: var(--radius);
                box-shadow: var(--shadow-lg);
                z-index: 9999;
                animation: slideIn 0.3s ease;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            `;
            
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
            
            // Add animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }

        function formatPrice(price) {
            if (!price && price !== 0) return 'â‚¦0';
            return `â‚¦${parseInt(price).toLocaleString()}`;
        }

        function showError(message) {
            const productContent = document.getElementById('productContent');
            productContent.innerHTML = `
                <div class="error">
                    <div class="error-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h2 class="error-title">Product Not Found</h2>
                    <p class="error-message">${message}</p>
                    <button onclick="window.location.href='index.html'" class="btn btn-primary" style="margin-top: 1rem;">
                        <i class="fas fa-home"></i>
                        Return to Homepage
                    </button>
                </div>
            `;
        }
    </script>
</body>
</html>
